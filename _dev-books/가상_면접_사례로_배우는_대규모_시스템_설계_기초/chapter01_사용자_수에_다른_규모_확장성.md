# chapter01. 사용자 수에 다른 규모 확장성

## 1. 단일 서버

- 웹, 앱, DB, 캐시 등 모든 서버가 한 대에서 실행되는 구조를 말한다.
- 요청의 처리 흐름
  1. DNS 에 도메인 이름에 매핑된 IP 주소를 요청한다.
  2. DNS 로 부터 응답받은 IP 주소로 HTTP 요청을 보낸다.
  3. 요청받은 웹서버는 HTML 페이지 또는 JSON 형태로 응답을 받는다.

<br>

## 2. 데이터베이스

- 사용자의 요청이 증가하면 서버 한대로는 부족하기 때문에 별도의 역할을 담당하는 서버를 구성한다.
- 데이터베이스 종류
  - **관계형 데이터베이스** : 열과 컬럼으로 구성된 데이터 베이스이다.
  - **비관계형 데이터베이스** : 관계형 데이터베이스를 제외한 나머지 유형의 데이터베이스를 총칭하는 말. NoSQL 이라고도 부른다.
    - 예시 : CouchDB, Neo4j, Cassandra, HBase, Amazon DynamoDB 가 있다.
    - 종류 : key-value store, graph store, column store, document store 가 있다.
- 아래와 같은 경우에 대한 고려 사항이 있을 경우 NoSQL 을 사용하도록 하자.
  - 낮은 응답 지연시간(latency)
  - 다루는 데이터가 비정형의 형태인 경우
  - 데이터(JSON, YAML, XML 등) 을 직렬화하거나 역직렬화 할 수 있기만 한 경우
  - 빅데이터의 경우

<br>

## 3. 수직적 규모 확장 vs 수평적 규모 확장

**`scale up`**

- 서버에 고사양의 자원을 추가하는 행위 (e.g. 더 좋은 CPU, 더 좋은 RAM)
- 서버로 유입되는 트래픽 양이 적을 때 좋은 선택이다.
- 단순한 것이 장점이지만 심각한 단점이 많다.
- 단점
  - 한 대에 서버에 자원을 무한대로 증설할 수 없다.
  - 자동복구(failover) 또는 다중화(redundancy) 방안이 없어 장애가 발생하면 서비스가 중단된다.

<br>

**`scale out`**

- 더 많은 서버를 추가하여 성능을 개선하는 행위
- 대규모 서비스 또는 서비스의 지속성 측면에서는 수평적 규모 확장이 적합한 방법이다.

<br>

## 4. 로드 밸런서(load balancer)

- 역할 : 부하 분산 집합(load balancing set) 에 속한 웹 서버들에게 트래픽을 고르게 분산하는 역할을 한다.
- 동작 방식 : 클라이언트가 로드밸런서의 public IP address 로 접속하면 load balancer 는 private IP address 로 트래픽을 분산시킨다.

<br>

## 5. 데이터베이스 다중화

- 어려 DB 서버를 운영하는 방식을 말한다.
- Master-Slave 관계를 설정하고 데이터 원본은 Master 에서, 사본은 Slave 에서 저장하는 방식을 사용한다.
- 다중화의 장점
  1. 쓰기를 담당하는 Master, 읽기는 담당하는 Slave 로 구분하여 병렬 처리가 가능해 성능이 좋아진다.
  2. 안정성 : 서버가 도중에 하나 다운되도 데이터를 보존할 수 있다.
  3. 가용성 : 데이터를 여러개로 복제하기 때문에 서버 하나가 다운 되더라도 다른 서버로 운영할 수 있다.
- 부 서버에 보관된 데이터가 최신 상태가 아닐 수 있기 때문에 **다중 마스터** 또는 **원형 다중화 방식** 을 도입하도록 한다.

<br>

## 6. 캐시

- 값비싼 연산 결과 또는 자주 참조하는 데이터를 메모리 저장한다. 이후 요청에 빠른 성능을 위함이다.  
- 읽기 주도형 캐시 전략(read-through caching strategy)
  - 캐싱된 데이터가 있다면 캐싱한 데이터를 반환하고 없을 경우, 데이터베이스 질의를 통해 데이터를 찾아 캐시에 저장하고 데이터를 반환한다.
- 캐시 사용시 유의할 점
  - 갱신은 자주 일어나지 않지만 참조는 빈번한 데이터인지
  - 휘발성 메모리로 관리해도 되는 데이터인지
  - 데이터의 만료시간(TTL)을 어떻게 설정할 것인지
  - 일관성(consistency) 유지 방법
  - 장애 대처 방법 : 캐시 서버를 한대만 둘 경우 단일 장애 지점(Single Point of Failure)이 될 가능성이 크다.
  - 캐시 메모리 크기 설정
    - 데이터가 너무 자주 캐시에서 밀려나면(eviction) 캐시 성능이 떨어지게 된다.
    - 이를 막을 방법은 캐시 메모리 과할당(overprovision) 이다.
  - 데이터 방출(eviction) 정책
    - 캐시가 꽉 차버리면 추가로 캐시에 데이터를 넣어야 할 경우 기존 데이터를 내보내야 한다.
    - LRU(Least Recently Used) : 마지막으로 사용된 시점이 가장 오래된 데이ㅓㅌ를 내보내는 정책
    - LFU(Least Frequently User) : 사용 빈도가 낮은 데이터를 내보내는 정책(FIFO)
    
